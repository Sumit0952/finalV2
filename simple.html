<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Scraper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e09, #d0e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: #e9ecef;
        }

        .tab-btn.active {
            background: white;
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #007bff;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .results-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 200px;
        }

        .results-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }

        .profile-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .profile-info {
            text-align: center;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: block;
            border: 3px solid #007bff;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-username {
            color: #666;
            margin-bottom: 10px;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .post-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .post-content {
            padding: 15px;
        }

        .post-description {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 10px;
        }

        .post-stats {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .post-link {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .post-image-placeholder {
            border-radius: 8px 8px 0 0;
            position: relative;
            overflow: hidden;
        }

        .post-image-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            display: none;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .analytics-section {
            margin-bottom: 30px;
        }

        .analytics-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        .analytics-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-left: 4px solid #007bff;
        }

        .analytics-card h4 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .analytics-card .value {
            color: #007bff;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .analytics-card .label {
            color: #999;
            font-size: 0.8rem;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .performance-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .performance-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }

        .metric-value {
            color: #333;
            font-weight: bold;
        }

        .engagement-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .engagement-fill {
            height: 100%;
            background: linear-gradient(135deg, #007bff, #0056b3);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }

            .profile-stats {
                gap: 20px;
            }

            .posts-grid {
                grid-template-columns: 1fr;
            }

            .analytics-cards {
                grid-template-columns: 1fr;
            }

            .performance-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📸 Instagram Scraper</h1>
            <p>Fetch Instagram profiles, posts, and reels data</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="profile">👤 Profile</button>
            <button class="tab-btn" data-tab="posts">📷 Posts</button>
            <button class="tab-btn" data-tab="reels">🎬 Reels</button>
            <button class="tab-btn" data-tab="analytics">📊 Analytics</button>
        </div>

        <div class="content">
            <div class="form-section">
                <div class="input-group">
                    <label for="username">Instagram Username:</label>
                    <input type="text" id="username" placeholder="Enter username (e.g., virat.kohli)" />
                </div>

                <div class="input-group">
                    <label for="sessionId">Instagram Session ID:</label>
                    <input type="text" id="sessionId" placeholder="Enter your Instagram session ID" />
                </div>

                <div class="input-group" id="maxItemsGroup" style="display: none;">
                    <label for="maxItems">Max Items:</label>
                    <input type="number" id="maxItems" value="20" min="1" max="100" />
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="scrapeBtn">🔍 Scrape Data</button>
                    <button class="btn btn-secondary" id="loadBtn">📂 Load from Database</button>
                </div>
            </div>

            <div class="loading" id="loading">
                <p>⏳ Loading data...</p>
            </div>

            <div class="error" id="error"></div>
            <div class="success" id="success"></div>

            <div class="results-section">
                <h2 class="results-title" id="resultsTitle">Results</h2>

                <!-- Profile Tab Content -->
                <div class="tab-content active" id="profile-content">
                    <div class="profile-card" id="profileCard" style="display: none;">
                        <div class="profile-info">
                            <img class="profile-avatar" id="profileAvatar" src="" alt="Profile Picture" />
                            <div class="profile-name" id="profileName"></div>
                            <div class="profile-username" id="profileUsername"></div>
                            <div class="profile-bio" id="profileBio"></div>
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <span class="stat-number" id="followersCount">0</span>
                                    <span class="stat-label">Followers</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="followingCount">0</span>
                                    <span class="stat-label">Following</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="postsCount">0</span>
                                    <span class="stat-label">Posts</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Posts Tab Content -->
                <div class="tab-content" id="posts-content">
                    <div class="posts-grid" id="postsGrid"></div>
                </div>

                <!-- Reels Tab Content -->
                <div class="tab-content" id="reels-content">
                    <div class="posts-grid" id="reelsGrid"></div>
                </div>

                <!-- Analytics Tab Content -->
                <div class="tab-content" id="analytics-content">
                    <div id="analyticsContainer">
                        <div class="analytics-section">
                            <h3>📊 Engagement Analytics</h3>
                            <div class="analytics-cards" id="analyticsCards"></div>
                        </div>
                        <div class="analytics-section">
                            <h3>📈 Content Performance</h3>
                            <div class="performance-grid" id="performanceGrid"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'profile';
        const API_BASE_URL = 'http://localhost:3000/api';

        // DOM elements
        const elements = {
            username: document.getElementById('username'),
            sessionId: document.getElementById('sessionId'),
            maxItems: document.getElementById('maxItems'),
            scrapeBtn: document.getElementById('scrapeBtn'),
            loadBtn: document.getElementById('loadBtn'),
            loading: document.getElementById('loading'),
            error: document.getElementById('error'),
            success: document.getElementById('success'),
            maxItemsGroup: document.getElementById('maxItemsGroup'),
            profileCard: document.getElementById('profileCard'),
            postsGrid: document.getElementById('postsGrid'),
            reelsGrid: document.getElementById('reelsGrid')
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeButtons();
            
            // Load saved session ID
            const savedSessionId = localStorage.getItem('instagram_session_id');
            if (savedSessionId) {
                elements.sessionId.value = savedSessionId;
            }
        });

        // Tab functionality
        function initializeTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });
        }

        function switchTab(tabName) {
            currentTab = tabName;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-content`).classList.add('active');

            // Show/hide max items for posts and reels
            elements.maxItemsGroup.style.display = (tabName !== 'profile' && tabName !== 'analytics') ? 'block' : 'none';

            // Update button text and visibility
            if (tabName === 'analytics') {
                elements.scrapeBtn.style.display = 'none';
                elements.loadBtn.textContent = '📊 Load Analytics';
            } else {
                elements.scrapeBtn.style.display = 'inline-block';
                const action = tabName.charAt(0).toUpperCase() + tabName.slice(1);
                elements.scrapeBtn.textContent = `🔍 Scrape ${action}`;
                elements.loadBtn.textContent = `📂 Load ${action}`;
            }
        }

        // Button functionality
        function initializeButtons() {
            elements.scrapeBtn.addEventListener('click', handleScrape);
            elements.loadBtn.addEventListener('click', handleLoad);
            
            // Save session ID
            elements.sessionId.addEventListener('change', () => {
                if (elements.sessionId.value.trim()) {
                    localStorage.setItem('instagram_session_id', elements.sessionId.value.trim());
                }
            });
        }

        // API functions
        async function handleScrape() {
            const username = elements.username.value.trim();
            const sessionId = elements.sessionId.value.trim();

            if (!username) {
                showError('Please enter a username');
                return;
            }

            if (!sessionId) {
                showError('Please enter your Instagram session ID');
                return;
            }

            const requestData = { username, sessionId };
            
            if (currentTab !== 'profile') {
                requestData[currentTab === 'posts' ? 'maxPosts' : 'maxReels'] = parseInt(elements.maxItems.value) || 20;
            }

            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/scrape/${currentTab}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess(`${currentTab} scraped successfully!`);
                    displayData(data.data || data);
                } else {
                    showError(data.message || 'Failed to scrape data');
                }
            } catch (error) {
                showError('Network error. Please check if the server is running.');
            } finally {
                hideLoading();
            }
        }

        async function handleLoad() {
            const username = elements.username.value.trim();

            if (!username) {
                showError('Please enter a username');
                return;
            }

            showLoading();
            
            try {
                let url;
                if (currentTab === 'analytics') {
                    url = `${API_BASE_URL}/scrape/analytics/${username}`;
                } else {
                    url = `${API_BASE_URL}/scrape/${currentTab}/${username}`;
                    if (currentTab !== 'profile') {
                        url += `?limit=${parseInt(elements.maxItems.value) || 50}`;
                    }
                }

                console.log('Loading from URL:', url); // Debug log
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('API Response:', data); // Debug log

                if (response.ok) {
                    showSuccess(`${currentTab} loaded from database!`);
                    displayData(data.data || data);
                } else {
                    showError(data.message || 'No data found in database');
                }
            } catch (error) {
                console.error('Load error:', error); // Debug log
                showError('Network error. Please check if the server is running.');
            } finally {
                hideLoading();
            }
        }

        // Display functions
        function displayData(data) {
            clearResults();
            
            console.log('Displaying data:', data); // Debug log

            switch (currentTab) {
                case 'profile':
                    displayProfile(data);
                    break;
                case 'posts':
                    displayPosts(data.posts || data || []);
                    break;
                case 'reels':
                    displayReels(data.reels || data || []);
                    break;
                case 'analytics':
                    displayAnalytics(data);
                    break;
            }
        }

        function displayProfile(data) {
            const profileImg = document.getElementById('profileAvatar');
            
            // Create fallback for profile picture
            if (data.profilePicture) {
                profileImg.src = getProxyImageUrl(data.profilePicture);
                profileImg.onerror = function() {
                    this.style.display = 'none';
                    // Create a styled placeholder
                    const placeholder = document.createElement('div');
                    placeholder.style.cssText = `
                        width: 100px; 
                        height: 100px; 
                        border-radius: 50%; 
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        color: white; 
                        font-size: 2rem; 
                        font-weight: bold;
                        margin: 0 auto 15px;
                        border: 3px solid #007bff;
                    `;
                    placeholder.textContent = (data.username || 'U').charAt(0).toUpperCase();
                    this.parentNode.insertBefore(placeholder, this);
                };
            } else {
                // No profile picture available
                profileImg.style.display = 'none';
                const placeholder = document.createElement('div');
                placeholder.style.cssText = `
                    width: 100px; 
                    height: 100px; 
                    border-radius: 50%; 
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    color: white; 
                    font-size: 2rem; 
                    font-weight: bold;
                    margin: 0 auto 15px;
                    border: 3px solid #007bff;
                `;
                placeholder.textContent = (data.username || 'U').charAt(0).toUpperCase();
                profileImg.parentNode.insertBefore(placeholder, profileImg);
            }
            
            document.getElementById('profileName').textContent = data.displayName || data.username || 'Unknown';
            document.getElementById('profileUsername').textContent = `@${data.username || 'unknown'}`;
            document.getElementById('profileBio').textContent = data.bio || 'No bio available';
            document.getElementById('followersCount').textContent = formatNumber(data.followersCount);
            document.getElementById('followingCount').textContent = formatNumber(data.followingCount);
            document.getElementById('postsCount').textContent = formatNumber(data.postsCount);
            
            elements.profileCard.style.display = 'block';
        }

        function displayPosts(posts) {
            if (!posts.length) {
                elements.postsGrid.innerHTML = '<p>No posts found</p>';
                return;
            }

            elements.postsGrid.innerHTML = posts.map((post, index) => `
                <div class="post-card">
                    ${post.postThumbnail ? 
                        `<img src="${getProxyImageUrl(post.postThumbnail)}" 
                             alt="Post ${post.postNumber || index + 1}" 
                             class="post-image" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                             onload="this.nextElementSibling.style.display='none';">
                         <div class="post-image-placeholder" style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: none; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                             📷 Post ${post.postNumber || index + 1}
                         </div>` 
                        : 
                        `<div class="post-image-placeholder" style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                             📷 Post ${post.postNumber || index + 1}
                         </div>`
                    }
                    <div class="post-content">
                        <div class="post-description">${escapeHtml(post.postDescription || 'No description')}</div>
                        <div class="post-stats">
                            <span>❤️ ${post.postLikes || 'N/A'}</span>
                            <span>💬 ${post.postComments || 'N/A'}</span>
                        </div>
                        <div class="post-link">
                            <a href="${post.postUrl || '#'}" target="_blank" rel="noopener" style="color: #007bff; text-decoration: none; font-size: 0.9rem;">🔗 View on Instagram</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayReels(reels) {
            if (!reels.length) {
                elements.reelsGrid.innerHTML = '<p>No reels found</p>';
                return;
            }

            elements.reelsGrid.innerHTML = reels.map((reel, index) => `
                <div class="post-card">
                    ${reel.reelThumbnail ? 
                        `<img src="${getProxyImageUrl(reel.reelThumbnail)}" 
                             alt="Reel ${reel.reelNumber || index + 1}" 
                             class="post-image" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                             onload="this.nextElementSibling.style.display='none';">
                         <div class="post-image-placeholder" style="width: 100%; height: 200px; background: linear-gradient(135deg, #e09 0%, #d0e 100%); display: none; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                             🎬 Reel ${reel.reelNumber || index + 1}
                         </div>` 
                        : 
                        `<div class="post-image-placeholder" style="width: 100%; height: 200px; background: linear-gradient(135deg, #e09 0%, #d0e 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                             🎬 Reel ${reel.reelNumber || index + 1}
                         </div>`
                    }
                    <div class="post-content">
                        <div class="post-description">${escapeHtml(reel.reelCaption || 'No caption available')}</div>
                        <div class="post-stats">
                            <span>❤️ ${reel.reelLikes || 'N/A'}</span>
                            <span>💬 ${reel.reelComments || 'N/A'}</span>
                        </div>
                        <div class="post-link">
                            <a href="${reel.reelUrl || '#'}" target="_blank" rel="noopener" style="color: #007bff; text-decoration: none; font-size: 0.9rem;">🔗 View Reel</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Image proxy function
        function getProxyImageUrl(originalUrl) {
            if (!originalUrl) return null;
            return `${API_BASE_URL}/proxy-image?url=${encodeURIComponent(originalUrl)}`;
        }

        // Utility functions
        function showLoading() {
            elements.loading.style.display = 'block';
            elements.scrapeBtn.disabled = true;
            elements.loadBtn.disabled = true;
        }

        function hideLoading() {
            elements.loading.style.display = 'none';
            elements.scrapeBtn.disabled = false;
            elements.loadBtn.disabled = false;
        }

        function showError(message) {
            hideMessages();
            elements.error.textContent = message;
            elements.error.style.display = 'block';
            setTimeout(hideMessages, 5000);
        }

        function showSuccess(message) {
            hideMessages();
            elements.success.textContent = message;
            elements.success.style.display = 'block';
            setTimeout(hideMessages, 3000);
        }

        function hideMessages() {
            elements.error.style.display = 'none';
            elements.success.style.display = 'none';
        }

        function clearResults() {
            elements.profileCard.style.display = 'none';
            elements.postsGrid.innerHTML = '';
            elements.reelsGrid.innerHTML = '';
            
            // Clear any existing profile picture placeholders
            const profileInfo = document.querySelector('.profile-info');
            if (profileInfo) {
                const placeholders = profileInfo.querySelectorAll('div[style*="border-radius: 50%"]');
                placeholders.forEach(placeholder => placeholder.remove());
                
                // Reset profile avatar
                const profileImg = document.getElementById('profileAvatar');
                if (profileImg) {
                    profileImg.style.display = 'block';
                    profileImg.onerror = null;
                }
            }
        }

        function formatNumber(num) {
            if (!num) return '0';
            if (typeof num === 'string') return num;
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function displayAnalytics(data) {
            const analyticsCards = document.getElementById('analyticsCards');
            const performanceGrid = document.getElementById('performanceGrid');

            // Main analytics cards
            analyticsCards.innerHTML = `
                <div class="analytics-card">
                    <h4>Average Likes per Post</h4>
                    <div class="value">${data.posts?.averageLikes?.formatted || '0'}</div>
                    <div class="label">Posts analyzed: ${data.posts?.totalPosts || 0}</div>
                </div>
                <div class="analytics-card">
                    <h4>Average Comments per Post</h4>
                    <div class="value">${data.posts?.averageComments?.formatted || '0'}</div>
                    <div class="label">With data: ${data.posts?.postsWithEngagementData || 0}</div>
                </div>
                <div class="analytics-card">
                    <h4>Posts Engagement Rate</h4>
                    <div class="value">${data.posts?.engagementRate?.formatted || '0%'}</div>
                    <div class="label">Based on followers: ${formatNumber(data.profile?.followersCount)}</div>
                </div>
                <div class="analytics-card">
                    <h4>Overall Engagement Rate</h4>
                    <div class="value">${data.overall?.overallEngagementRate?.formatted || '0%'}</div>
                    <div class="label">All content: ${data.overall?.totalContent || 0}</div>
                </div>
            `;

            // Performance breakdown
            performanceGrid.innerHTML = `
                <div class="performance-card">
                    <h4>📷 Posts Performance</h4>
                    <div class="metric-row">
                        <span class="metric-label">Total Posts</span>
                        <span class="metric-value">${data.posts?.totalPosts || 0}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total Likes</span>
                        <span class="metric-value">${data.posts?.totalLikes?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total Comments</span>
                        <span class="metric-value">${data.posts?.totalComments?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Data Quality</span>
                        <span class="metric-value">${data.posts?.dataQuality || 'No data'}</span>
                    </div>
                    ${data.posts?.engagementRate?.value ? `
                    <div class="engagement-bar">
                        <div class="engagement-fill" style="width: ${Math.min(data.posts.engagementRate.value, 10) * 10}%"></div>
                    </div>` : ''}
                </div>
                
                <div class="performance-card">
                    <h4>🎬 Reels Performance</h4>
                    <div class="metric-row">
                        <span class="metric-label">Total Reels</span>
                        <span class="metric-value">${data.reels?.totalReels || 0}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Average Likes</span>
                        <span class="metric-value">${data.reels?.averageLikes?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Average Comments</span>
                        <span class="metric-value">${data.reels?.averageComments?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Engagement Rate</span>
                        <span class="metric-value">${data.reels?.engagementRate?.formatted || '0%'}</span>
                    </div>
                    ${data.reels?.engagementRate?.value ? `
                    <div class="engagement-bar">
                        <div class="engagement-fill" style="width: ${Math.min(data.reels.engagementRate.value, 10) * 10}%"></div>
                    </div>` : ''}
                </div>

                <div class="performance-card">
                    <h4>🎯 Engagement Breakdown</h4>
                    <div class="metric-row">
                        <span class="metric-label">Total Engagement</span>
                        <span class="metric-value">${data.overall?.totalEngagement?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Likes (${data.overall?.engagementBreakdown?.likes?.percentage || 0}%)</span>
                        <span class="metric-value">${data.overall?.engagementBreakdown?.likes?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Comments (${data.overall?.engagementBreakdown?.comments?.percentage || 0}%)</span>
                        <span class="metric-value">${data.overall?.engagementBreakdown?.comments?.formatted || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Data Quality</span>
                        <span class="metric-value">${data.summary?.dataQuality || 'No data'}</span>
                    </div>
                </div>

                <div class="performance-card">
                    <h4>📊 Summary</h4>
                    <div class="metric-row">
                        <span class="metric-label">Profile</span>
                        <span class="metric-value">${data.profile?.username || 'N/A'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Followers</span>
                        <span class="metric-value">${formatNumber(data.profile?.followersCount) || '0'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Content Analyzed</span>
                        <span class="metric-value">${data.summary?.totalContentAnalyzed || 0}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Last Updated</span>
                        <span class="metric-value">${data.profile?.lastScraped ? new Date(data.profile.lastScraped).toLocaleDateString() : 'N/A'}</span>
                    </div>
                </div>
            `;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>